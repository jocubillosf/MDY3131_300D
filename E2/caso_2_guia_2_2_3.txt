/*DROP SEQUENCE seq_med_ser_com;
COMMIT;
CREATE SEQUENCE seq_med_ser_com
    START WITH 1
    INCREMENT BY 1;
COMMIT;
*/

DECLARE

CURSOR cur_medicos IS
SELECT --seq_med_ser_com.nextval ID_MED_SCOMUN
    UNI.NOMBRE UNIDAD
    ,MED.MED_RUN || '-' || MED.DV_RUN RUN_MEDICO
    ,MED.PNOMBRE || ' ' || MED.SNOMBRE || ' ' || MED.APATERNO || ' ' || MED.AMATERNO NOMBRE_MEDICO
    ,SUBSTR(UNI.NOMBRE,1,2) || SUBSTR(MED.APATERNO,-3,2) || SUBSTR(MED.MED_RUN,-3) || '@KETEKURA.COM' CORREO
    ,(SELECT COUNT(ATE_ID)
        FROM ATENCION
        WHERE MED_RUN = MED.MED_RUN) CANT_ATENCIONES
    
    
FROM MEDICO MED 
JOIN UNIDAD UNI
ON MED.UNI_ID = UNI.UNI_ID
;
BEGIN
    FOR rec_medicos IN cur_medicos
    LOOP
            DBMS_OUTPUT.PUT_LINE(rec_medicos.ID_MED_SCOMUN);
    END LOOP;
END;